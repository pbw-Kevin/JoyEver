import{U as ye,$ as z,V as we,W as Q,X as te,Y as be,Z as ke,a0 as he,a1 as se,a2 as fe,a3 as ne,a4 as Ce,a5 as Ae,a6 as Ee,a7 as Re,a8 as Oe,a9 as Te,aa as Be,ab as Ge,ac as Me,ad as Ne,ae as Se,af as Le,ag as qe,d as Ve,y as Ue,K as De,ah as ie,C as B,N as Fe,S as ze,ai as j,aj as re,p as Pe,ak as je,c as G,a as v,al as $,e as U,u as g,am as W,an as _,t as K,b as Z,F as $e,q as We,ao as _e,ap as X,aq as Ke,ar as Qe,as as He,o as M,at as oe,au as Xe,_ as Je}from"./index-D2whVdz8.js";const Ze={onClick:Q},le="mdui.functions.dialog.";let Y;const ge=p=>{const e=new ye,t=z(e),n=["headline","description","icon","closeOnEsc","closeOnOverlayClick","stackedActions"],a=["onOpen","onOpened","onClose","onClosed","onOverlayClick"];return Object.entries(p).forEach(([r,u])=>{if(n.includes(r))e[r]=u;else if(a.includes(r)){const o=we(r.slice(2));t.on(o,m=>{m.target===e&&u.call(e,e)})}}),p.body&&t.append(p.body),p.actions&&p.actions.forEach(r=>{const u=Object.assign({},Ze,r);z(`<mdui-button
        slot="action"
        variant="text"
      >${u.text}</mdui-button>`).appendTo(t).on("click",function(){const o=u.onClick.call(e,e);te(o)?(this.loading=!0,o.then(()=>{e.open=!1}).finally(()=>{this.loading=!1})):o!==!1&&(e.open=!1)})}),t.appendTo("body").on("closed",r=>{r.target===e&&(t.remove(),p.queue&&(Y=void 0,be(le+p.queue)))}),p.queue?Y?ke(le+p.queue,()=>{e.open=!0,Y=e}):(setTimeout(()=>{e.open=!0}),Y=e):setTimeout(()=>{e.open=!0}),e},ue=()=>ne("OK"),de=()=>ne("Cancel"),Ye=p=>{const e=Object.assign({},{confirmText:ue(),cancelText:de(),onConfirm:Q,onCancel:Q},p),t=["headline","description","icon","closeOnEsc","closeOnOverlayClick","stackedActions","queue","onOpen","onOpened","onClose","onClosed","onOverlayClick"];return new Promise((n,a)=>{let r=!1;const u=ge({...Object.fromEntries(t.filter(o=>!he(e[o])).map(o=>[o,e[o]])),actions:[{text:e.cancelText,onClick:o=>e.onCancel.call(o,o)},{text:e.confirmText,onClick:o=>{const m=e.onConfirm.call(o,o);return te(m)?m.then(()=>{r=!0}):m!==!1&&(r=!0),m}}]});p.confirmText||se(u,()=>{z(u).find('[slot="action"]').last().text(ue())}),p.cancelText||se(u,()=>{z(u).find('[slot="action"]').first().text(de())}),z(u).on("close",o=>{o.target===u&&(r?n():a(),fe(u))})})};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{fromInt(e){return Ce(e)}toInt(e){return Ae(e[0],e[1],e[2])}distance(e,t){const n=e[0]-t[0],a=e[1]-t[1],r=e[2]-t[2];return n*n+a*a+r*r}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tt=10,st=3;class nt{static quantize(e,t,n){const a=new Map,r=new Array,u=new Array,o=new et;let m=0;for(let d=0;d<e.length;d++){const y=e[d],T=a.get(y);T===void 0?(m++,r.push(o.fromInt(y)),u.push(y),a.set(y,1)):a.set(y,T+1)}const k=new Array;for(let d=0;d<m;d++){const y=u[d],T=a.get(y);T!==void 0&&(k[d]=T)}let h=Math.min(n,m);t.length>0&&(h=Math.min(h,t.length));const x=new Array;for(let d=0;d<t.length;d++)x.push(o.fromInt(t[d]));const w=h-x.length;if(t.length===0&&w>0)for(let d=0;d<w;d++){const y=Math.random()*100,T=Math.random()*201+-100,q=Math.random()*201+-100;x.push(new Array(y,T,q))}const I=new Array;for(let d=0;d<m;d++)I.push(Math.floor(Math.random()*h));const E=new Array;for(let d=0;d<h;d++){E.push(new Array);for(let y=0;y<h;y++)E[d].push(0)}const b=new Array;for(let d=0;d<h;d++){b.push(new Array);for(let y=0;y<h;y++)b[d].push(new at)}const C=new Array;for(let d=0;d<h;d++)C.push(0);for(let d=0;d<tt;d++){for(let i=0;i<h;i++){for(let f=i+1;f<h;f++){const A=o.distance(x[i],x[f]);b[f][i].distance=A,b[f][i].index=i,b[i][f].distance=A,b[i][f].index=f}b[i].sort();for(let f=0;f<h;f++)E[i][f]=b[i][f].index}let y=0;for(let i=0;i<m;i++){const f=r[i],A=I[i],V=x[A],S=o.distance(f,V);let H=S,D=-1;for(let P=0;P<h;P++){if(b[A][P].distance>=4*S)continue;const F=o.distance(f,x[P]);F<H&&(H=F,D=P)}D!==-1&&Math.abs(Math.sqrt(H)-Math.sqrt(S))>st&&(y++,I[i]=D)}if(y===0&&d!==0)break;const T=new Array(h).fill(0),q=new Array(h).fill(0),R=new Array(h).fill(0);for(let i=0;i<h;i++)C[i]=0;for(let i=0;i<m;i++){const f=I[i],A=r[i],V=k[i];C[f]+=V,T[f]+=A[0]*V,q[f]+=A[1]*V,R[f]+=A[2]*V}for(let i=0;i<h;i++){const f=C[i];if(f===0){x[i]=[0,0,0];continue}const A=T[i]/f,V=q[i]/f,S=R[i]/f;x[i]=[A,V,S]}}const O=new Map;for(let d=0;d<h;d++){const y=C[d];if(y===0)continue;const T=o.toInt(x[d]);O.has(T)||O.set(T,y)}return O}}class at{constructor(){this.distance=-1,this.index=-1}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{static quantize(e){const t=new Map;for(let n=0;n<e.length;n++){const a=e[n];Ee(a)<255||t.set(a,(t.get(a)??0)+1)}return t}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ee=5,L=33,J=35937,N={RED:"red",GREEN:"green",BLUE:"blue"};class rt{constructor(e=[],t=[],n=[],a=[],r=[],u=[]){this.weights=e,this.momentsR=t,this.momentsG=n,this.momentsB=a,this.moments=r,this.cubes=u}quantize(e,t){this.constructHistogram(e),this.computeMoments();const n=this.createBoxes(t);return this.createResult(n.resultCount)}constructHistogram(e){this.weights=Array.from({length:J}).fill(0),this.momentsR=Array.from({length:J}).fill(0),this.momentsG=Array.from({length:J}).fill(0),this.momentsB=Array.from({length:J}).fill(0),this.moments=Array.from({length:J}).fill(0);const t=it.quantize(e);for(const[n,a]of t.entries()){const r=Re(n),u=Oe(n),o=Te(n),m=8-ee,k=(r>>m)+1,h=(u>>m)+1,x=(o>>m)+1,w=this.getIndex(k,h,x);this.weights[w]=(this.weights[w]??0)+a,this.momentsR[w]+=a*r,this.momentsG[w]+=a*u,this.momentsB[w]+=a*o,this.moments[w]+=a*(r*r+u*u+o*o)}}computeMoments(){for(let e=1;e<L;e++){const t=Array.from({length:L}).fill(0),n=Array.from({length:L}).fill(0),a=Array.from({length:L}).fill(0),r=Array.from({length:L}).fill(0),u=Array.from({length:L}).fill(0);for(let o=1;o<L;o++){let m=0,k=0,h=0,x=0,w=0;for(let I=1;I<L;I++){const E=this.getIndex(e,o,I);m+=this.weights[E],k+=this.momentsR[E],h+=this.momentsG[E],x+=this.momentsB[E],w+=this.moments[E],t[I]+=m,n[I]+=k,a[I]+=h,r[I]+=x,u[I]+=w;const b=this.getIndex(e-1,o,I);this.weights[E]=this.weights[b]+t[I],this.momentsR[E]=this.momentsR[b]+n[I],this.momentsG[E]=this.momentsG[b]+a[I],this.momentsB[E]=this.momentsB[b]+r[I],this.moments[E]=this.moments[b]+u[I]}}}}createBoxes(e){this.cubes=Array.from({length:e}).fill(0).map(()=>new ot);const t=Array.from({length:e}).fill(0);this.cubes[0].r0=0,this.cubes[0].g0=0,this.cubes[0].b0=0,this.cubes[0].r1=L-1,this.cubes[0].g1=L-1,this.cubes[0].b1=L-1;let n=e,a=0;for(let r=1;r<e;r++){this.cut(this.cubes[a],this.cubes[r])?(t[a]=this.cubes[a].vol>1?this.variance(this.cubes[a]):0,t[r]=this.cubes[r].vol>1?this.variance(this.cubes[r]):0):(t[a]=0,r--),a=0;let u=t[0];for(let o=1;o<=r;o++)t[o]>u&&(u=t[o],a=o);if(u<=0){n=r+1;break}}return new lt(e,n)}createResult(e){const t=[];for(let n=0;n<e;++n){const a=this.cubes[n],r=this.volume(a,this.weights);if(r>0){const u=Math.round(this.volume(a,this.momentsR)/r),o=Math.round(this.volume(a,this.momentsG)/r),m=Math.round(this.volume(a,this.momentsB)/r),k=255<<24|(u&255)<<16|(o&255)<<8|m&255;t.push(k)}}return t}variance(e){const t=this.volume(e,this.momentsR),n=this.volume(e,this.momentsG),a=this.volume(e,this.momentsB),r=this.moments[this.getIndex(e.r1,e.g1,e.b1)]-this.moments[this.getIndex(e.r1,e.g1,e.b0)]-this.moments[this.getIndex(e.r1,e.g0,e.b1)]+this.moments[this.getIndex(e.r1,e.g0,e.b0)]-this.moments[this.getIndex(e.r0,e.g1,e.b1)]+this.moments[this.getIndex(e.r0,e.g1,e.b0)]+this.moments[this.getIndex(e.r0,e.g0,e.b1)]-this.moments[this.getIndex(e.r0,e.g0,e.b0)],u=t*t+n*n+a*a,o=this.volume(e,this.weights);return r-u/o}cut(e,t){const n=this.volume(e,this.momentsR),a=this.volume(e,this.momentsG),r=this.volume(e,this.momentsB),u=this.volume(e,this.weights),o=this.maximize(e,N.RED,e.r0+1,e.r1,n,a,r,u),m=this.maximize(e,N.GREEN,e.g0+1,e.g1,n,a,r,u),k=this.maximize(e,N.BLUE,e.b0+1,e.b1,n,a,r,u);let h;const x=o.maximum,w=m.maximum,I=k.maximum;if(x>=w&&x>=I){if(o.cutLocation<0)return!1;h=N.RED}else w>=x&&w>=I?h=N.GREEN:h=N.BLUE;switch(t.r1=e.r1,t.g1=e.g1,t.b1=e.b1,h){case N.RED:e.r1=o.cutLocation,t.r0=e.r1,t.g0=e.g0,t.b0=e.b0;break;case N.GREEN:e.g1=m.cutLocation,t.r0=e.r0,t.g0=e.g1,t.b0=e.b0;break;case N.BLUE:e.b1=k.cutLocation,t.r0=e.r0,t.g0=e.g0,t.b0=e.b1;break;default:throw new Error("unexpected direction "+h)}return e.vol=(e.r1-e.r0)*(e.g1-e.g0)*(e.b1-e.b0),t.vol=(t.r1-t.r0)*(t.g1-t.g0)*(t.b1-t.b0),!0}maximize(e,t,n,a,r,u,o,m){const k=this.bottom(e,t,this.momentsR),h=this.bottom(e,t,this.momentsG),x=this.bottom(e,t,this.momentsB),w=this.bottom(e,t,this.weights);let I=0,E=-1,b=0,C=0,O=0,d=0;for(let y=n;y<a;y++){if(b=k+this.top(e,t,y,this.momentsR),C=h+this.top(e,t,y,this.momentsG),O=x+this.top(e,t,y,this.momentsB),d=w+this.top(e,t,y,this.weights),d===0)continue;let T=(b*b+C*C+O*O)*1,q=d*1,R=T/q;b=r-b,C=u-C,O=o-O,d=m-d,d!==0&&(T=(b*b+C*C+O*O)*1,q=d*1,R+=T/q,R>I&&(I=R,E=y))}return new ut(E,I)}volume(e,t){return t[this.getIndex(e.r1,e.g1,e.b1)]-t[this.getIndex(e.r1,e.g1,e.b0)]-t[this.getIndex(e.r1,e.g0,e.b1)]+t[this.getIndex(e.r1,e.g0,e.b0)]-t[this.getIndex(e.r0,e.g1,e.b1)]+t[this.getIndex(e.r0,e.g1,e.b0)]+t[this.getIndex(e.r0,e.g0,e.b1)]-t[this.getIndex(e.r0,e.g0,e.b0)]}bottom(e,t,n){switch(t){case N.RED:return-n[this.getIndex(e.r0,e.g1,e.b1)]+n[this.getIndex(e.r0,e.g1,e.b0)]+n[this.getIndex(e.r0,e.g0,e.b1)]-n[this.getIndex(e.r0,e.g0,e.b0)];case N.GREEN:return-n[this.getIndex(e.r1,e.g0,e.b1)]+n[this.getIndex(e.r1,e.g0,e.b0)]+n[this.getIndex(e.r0,e.g0,e.b1)]-n[this.getIndex(e.r0,e.g0,e.b0)];case N.BLUE:return-n[this.getIndex(e.r1,e.g1,e.b0)]+n[this.getIndex(e.r1,e.g0,e.b0)]+n[this.getIndex(e.r0,e.g1,e.b0)]-n[this.getIndex(e.r0,e.g0,e.b0)];default:throw new Error("unexpected direction $direction")}}top(e,t,n,a){switch(t){case N.RED:return a[this.getIndex(n,e.g1,e.b1)]-a[this.getIndex(n,e.g1,e.b0)]-a[this.getIndex(n,e.g0,e.b1)]+a[this.getIndex(n,e.g0,e.b0)];case N.GREEN:return a[this.getIndex(e.r1,n,e.b1)]-a[this.getIndex(e.r1,n,e.b0)]-a[this.getIndex(e.r0,n,e.b1)]+a[this.getIndex(e.r0,n,e.b0)];case N.BLUE:return a[this.getIndex(e.r1,e.g1,n)]-a[this.getIndex(e.r1,e.g0,n)]-a[this.getIndex(e.r0,e.g1,n)]+a[this.getIndex(e.r0,e.g0,n)];default:throw new Error("unexpected direction $direction")}}getIndex(e,t,n){return(e<<ee*2)+(e<<ee+1)+e+(t<<ee)+t+n}}class ot{constructor(e=0,t=0,n=0,a=0,r=0,u=0,o=0){this.r0=e,this.r1=t,this.g0=n,this.g1=a,this.b0=r,this.b1=u,this.vol=o}}class lt{constructor(e,t){this.requestedCount=e,this.resultCount=t}}class ut{constructor(e,t){this.cutLocation=e,this.maximum=t}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dt{static quantize(e,t){const a=new rt().quantize(e,t);return nt.quantize(e,a,t)}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ct(p){const e=await new Promise((u,o)=>{const m=document.createElement("canvas"),k=m.getContext("2d");if(!k){o(new Error("Could not get canvas context"));return}const h=()=>{m.width=p.width,m.height=p.height,k.drawImage(p,0,0);let w=[0,0,p.width,p.height];const I=p.dataset.area;I&&/^\d+(\s*,\s*\d+){3}$/.test(I)&&(w=I.split(/\s*,\s*/).map(d=>parseInt(d,10)));const[E,b,C,O]=w;u(k.getImageData(E,b,C,O).data)},x=()=>{o(new Error("Image load failed"))};p.complete?h():(p.onload=h,p.onerror=x)}),t=[];for(let u=0;u<e.length;u+=4){const o=e[u],m=e[u+1],k=e[u+2];if(e[u+3]<255)continue;const x=Ge(o,m,k);t.push(x)}const n=dt.quantize(t,128);return Be.score(n)[0]}const mt=async p=>{const e=z(p),t=await ct(e[0]);return Me(t)},ce=()=>ne("OK"),me=()=>ne("Cancel"),ht=p=>{const e=Object.assign({},{confirmText:ce(),cancelText:me(),onConfirm:Q,onCancel:Q,validator:Q,textFieldOptions:{}},p),t=["headline","description","icon","closeOnEsc","closeOnOverlayClick","stackedActions","queue","onOpen","onOpened","onClose","onClosed","onOverlayClick"],n=new Ne;return Object.entries(e.textFieldOptions).forEach(([a,r])=>{n[a]=r}),new Promise((a,r)=>{let u=!1;const o=ge({...Object.fromEntries(t.filter(m=>!he(e[m])).map(m=>[m,e[m]])),body:n,actions:[{text:e.cancelText,onClick:m=>e.onCancel.call(m,n.value,m)},{text:e.confirmText,onClick:m=>{const k=()=>{const x=e.onConfirm.call(m,n.value,m);return te(x)?x.then(()=>{u=!0}):x!==!1&&(u=!0),x};if(n.setCustomValidity(""),!n.reportValidity())return!1;const h=e.validator.call(n,n.value);return Se(h)&&!h?(n.setCustomValidity(" "),!1):Le(h)?(n.setCustomValidity(h),!1):te(h)?new Promise((x,w)=>{h.then(x).catch(I=>{n.setCustomValidity(I),w(I)})}):k()}}]});p.confirmText||se(o,()=>{z(o).find('[slot="action"]').last().text(ce())}),p.cancelText||se(o,()=>{z(o).find('[slot="action"]').first().text(me())}),z(o).on("close",m=>{m.target===o&&(u?a(n.value):r(),fe(o))})})},ft=(p,e=0)=>{const t=qe();let n,a;return function(...r){return n===void 0&&(n=t.setTimeout(()=>{a=p.apply(this,r),n=void 0},e)),a}},gt={class:"content"},vt=["value"],pt={slot:"helper",class:"error-info"},xt={key:0},It=["checked"],yt={key:0},wt={key:1},bt=["disabled"],kt={key:3},Ct={key:4},At={slot:"helper",class:"error-info"},Et={slot:"helper",class:"error-info"},Rt={key:1},Ot=["value"],Tt=["value"],Bt={key:2,class:"appearance-card"},Gt={key:0},Mt={key:1},Nt={key:2},St=["value"],Lt=["value"],qt={class:"color-scheme"},Vt=["disabled"],Ut={key:3,class:"error-info"},Dt={key:4},Ft=["value"],zt=["value"],Pt=["disabled"],jt=["disabled"],$t=["disabled"],Wt={key:5,class:"error-info"},_t=Ve({__name:"SettingView",setup(p){Ue();var e=De(),t=e.getUsername(),n=new ie.Object("UserInfo"),a=B(""),r=B(e.get("email")),u=B(!!r.value),o=new ie.Object("Email"),m=B(!1),k=B(e.get("emailVerified")),h=B(!1),x=B(!1);Fe().then(c=>{n=c,a.value=n.get("nickname")}),ze().then(c=>{o=c,m.value=o.getACL().getPublicReadAccess()}),j(a,c=>{n.set("nickname",c)});var w=B("");function I(){if(w.value="",r.value&&!_e(r.value)){w.value="邮箱格式不正确。";return}e.setEmail(r.value),e.save().then(c=>(k.value=c.get("emailVerified"),u.value=!!r.value,o.set("email",r.value))).then(()=>{X("邮箱已保存！",!0)}).catch(c=>{if(c.code==203){w.value="邮箱已被使用。请尝试其他邮箱。";return}w.value="保存邮箱时出现问题。"}),h.value=!1,x.value=!1}j(r,()=>{w.value=""});function E(c){m.value=c,o.getACL().setPublicReadAccess(c),o.save().then(()=>{X("邮箱隐私设置已更新！",!0)}).catch(s=>{X("更新邮箱隐私设置时出现问题。",!0)})}function b(){ie.User.requestEmailVerify(r.value).then(()=>{h.value=!0}).catch(c=>{x.value=!0})}var C=B(""),O=B(""),d=B({password:"",passwordAgain:""}),y=B(!1);function T(){if(d.value={password:"",passwordAgain:""},y.value=!1,C.value)if(Ke(C.value))if(C.value!==O.value){d.value.passwordAgain="两次输入的密码不一致。";return}else e.setPassword(C.value),y.value=!0;else{d.value.password="密码格式不正确。密码的长度应至少为 8 个字符，且不为空白字符。";return}else{d.value.password="请填写密码。";return}}var q=re(),R=B(oe),i=B({...re().value}),f=B(i.value.name),A=B(i.value.name),V=Pe(()=>JSON.stringify(R.value.find(c=>c.name===f.value))!==JSON.stringify(i.value));j(Xe,c=>{c&&(R.value=oe,i.value={...re().value},f.value=i.value.name,A.value=i.value.name)});var S=B(i.value.backgroundImage);j(f,c=>{var s=R.value.find(l=>l.name===c);s&&(i.value={...s},S.value=s.backgroundImage)}),j(i,c=>{q.value={...c}},{deep:!0});var H=ft(c=>{i.value.backgroundImage=c},1e3);j(S,(c,s)=>{c?s?H(c):(i.value.backgroundImageOpacity=.3,i.value.sidebarOpacity=.7,i.value.backgroundImage=c):(i.value.backgroundImageOpacity=0,i.value.sidebarOpacity=1)});var D=B("");function P(){D.value="";var c=new Image;c.src=i.value.backgroundImage,c.crossOrigin="anonymous",c.onload=()=>{mt(c).then(s=>{i.value.colorScheme=s}).catch(s=>{D.value=s.message})},c.onerror=s=>{D.value="无法加载背景图片。可能是跨域问题或图片不存在。"}}var F=B("");function ve(){F.value="";var c=R.value.find(l=>l.name===f.value);if(c){var s=R.value.find(l=>l.name===i.value.name);if(s&&s!==c){F.value="主题名已存在";return}Object.assign(c,{...i.value})}else R.value.push({...i.value});A.value===f.value&&(A.value=i.value.name),f.value=i.value.name}function pe(){ht({headline:"另存为新的主题",description:"在此处键入主题名",confirmText:"完成",cancelText:"取消",onConfirm:c=>{if(!c){F.value="主题名不能为空";return}if(R.value.some(l=>l.name===c)){F.value="主题名已存在。";return}var s={...i.value,name:c,isGeneral:!1};R.value.push(s),f.value=c}})}function xe(){A.value=f.value,Qe(i.value)}function Ie(){Ye({headline:"确认要删除主题吗？",description:"此操作不可撤销",confirmText:"删除",cancelText:"取消",onConfirm:()=>{var c;R.value=R.value.filter(s=>s.name!==f.value),f.value==A.value&&(A.value=((c=R.value.find(s=>s.isGeneral))==null?void 0:c.name)||""),f.value=A.value}})}async function ae(){var c=!1;await e.save().catch(s=>{c=!0}),await n.save().catch(s=>{c=!0}),await o.save().catch(s=>{c=!0}),await He().then(async s=>{s.set("customAppearance",R.value.filter(l=>!l.isGeneral).map(l=>({name:l.name,theme:l.theme,backgroundImage:l.backgroundImage,colorScheme:l.colorScheme,backgroundImageOpacity:l.backgroundImageOpacity,sidebarOpacity:l.sidebarOpacity}))),s.set("activeAppearance",A.value),await s.save().catch(l=>{c=!0})}),c?X("保存时出现问题。",!0):X("保存成功！",!0)}return je(()=>{ae()}),(c,s)=>(M(),G("div",gt,[s[28]||(s[28]=v("h1",null,"设置",-1)),v("mdui-button",{onClick:s[0]||(s[0]=l=>ae())},"保存设置"),s[29]||(s[29]=v("h2",null,"全局设置",-1)),v("mdui-text-field",{label:"用户名",variant:"outlined",readonly:"",value:g(t)},null,8,vt),$(v("mdui-text-field",{label:"昵称","onUpdate:modelValue":s[1]||(s[1]=l=>_(a)?a.value=l:a=l)},null,512),[[W,g(a)]]),$(v("mdui-text-field",{type:"email",label:"邮箱","onUpdate:modelValue":s[2]||(s[2]=l=>_(r)?r.value=l:r=l)},[v("span",pt,K(g(w)),1)],512),[[W,g(r)]]),v("mdui-button",{onClick:s[3]||(s[3]=l=>I())},"保存邮箱"),g(u)?(M(),G("div",xt,[v("mdui-checkbox",{checked:g(m),onInput:s[4]||(s[4]=l=>E(!l.target.checked))},"公开邮箱",40,It),s[22]||(s[22]=Z(" 邮箱状态：")),g(k)?(M(),G("span",yt,"已验证✔")):(M(),G("span",wt,"未验证❌")),g(k)?U("",!0):(M(),G("mdui-button",{key:2,onClick:s[5]||(s[5]=l=>b()),disabled:g(h)},"邮箱验证",8,bt)),g(h)?(M(),G("span",kt,"验证邮件已发送")):U("",!0),g(x)?(M(),G("span",Ct,"发送验证邮件失败")):U("",!0)])):U("",!0),s[30]||(s[30]=v("h3",null,"安全",-1)),$(v("mdui-text-field",{type:"password","toggle-password":"",label:"新密码","onUpdate:modelValue":s[6]||(s[6]=l=>_(C)?C.value=l:C=l)},[v("span",At,K(g(d).password),1)],512),[[W,g(C)]]),$(v("mdui-text-field",{type:"password","toggle-password":"",label:"确认新密码","onUpdate:modelValue":s[7]||(s[7]=l=>_(O)?O.value=l:O=l)},[v("span",Et,K(g(d).passwordAgain),1)],512),[[W,g(O)]]),v("mdui-button",{onClick:s[8]||(s[8]=l=>T())},"更改密码"),g(y)?(M(),G("span",Rt,"密码已更改！")):U("",!0),s[31]||(s[31]=v("h2",null,"游戏设置",-1)),s[32]||(s[32]=v("mdui-checkbox",null,"公开历史记录",-1)),s[33]||(s[33]=v("br",null,null,-1)),s[34]||(s[34]=v("mdui-checkbox",null,"自动禁用不可用手势",-1)),s[35]||(s[35]=v("h3",null,"自定义手势",-1)),s[36]||(s[36]=v("h2",null,"外观",-1)),s[37]||(s[37]=v("h3",null,"主题",-1)),v("mdui-select",{label:"选择主题",value:g(f),onChange:s[9]||(s[9]=l=>_(f)?f.value=l.target.value:f=l.target.value)},[(M(!0),G($e,null,We(g(R),l=>(M(),G("mdui-menu-item",{value:l.name},K(l.name),9,Tt))),256)),s[23]||(s[23]=v("mdui-button-icon",{slot:"end-icon"},[v("mdui-icon-keyboard-arrow-down")],-1))],40,Ot),g(f)?(M(),G("mdui-card",Bt,[g(i).isGeneral?(M(),G("span",Gt,"系统主题")):(M(),G("span",Mt,"自定义主题")),g(f)==g(A)?(M(),G("span",Nt," 已应用✔")):U("",!0),$(v("mdui-text-field",{label:"主题名称","onUpdate:modelValue":s[10]||(s[10]=l=>g(i).name=l)},null,512),[[W,g(i).name]]),v("mdui-select",{label:"深色/浅色模式",value:g(i).theme,onChange:s[11]||(s[11]=l=>g(i).theme=l.target.value)},s[24]||(s[24]=[v("mdui-menu-item",{value:"auto"},"跟随系统",-1),v("mdui-menu-item",{value:"light"},"浅色模式",-1),v("mdui-menu-item",{value:"dark"},"深色模式",-1),v("mdui-button-icon",{slot:"end-icon"},[v("mdui-icon-keyboard-arrow-down")],-1)]),40,St),v("mdui-text-field",{label:"背景图片URL",value:g(S),onInput:s[12]||(s[12]=l=>_(S)?S.value=l.target.value:S=l.target.value)},null,40,Lt),v("div",qt,[s[25]||(s[25]=Z(" 配色方案：")),$(v("input",{type:"color","onUpdate:modelValue":s[13]||(s[13]=l=>g(i).colorScheme=l)},null,512),[[W,g(i).colorScheme]]),v("mdui-button",{onClick:s[14]||(s[14]=l=>P()),disabled:!g(i).backgroundImage},"从背景图片中提取",8,Vt)]),g(D)?(M(),G("div",Ut,"提取失败。错误："+K(g(D)),1)):U("",!0),g(S)?(M(),G("div",Dt,[s[26]||(s[26]=Z(" 背景图片不透明度： ")),v("mdui-slider",{tickmarks:"",max:"10",step:"1",value:g(i).backgroundImageOpacity*10,onInput:s[15]||(s[15]=l=>g(i).backgroundImageOpacity=l.target.value/10)},null,40,Ft),s[27]||(s[27]=Z(" 侧边栏不透明度： ")),v("mdui-slider",{tickmarks:"",max:"10",step:"1",value:g(i).sidebarOpacity*10,onInput:s[16]||(s[16]=l=>g(i).sidebarOpacity=l.target.value/10)},null,40,zt)])):U("",!0),v("mdui-button",{onClick:s[17]||(s[17]=l=>ve()),disabled:!g(V)||g(i).isGeneral},"保存主题",8,Pt),v("mdui-button",{onClick:s[18]||(s[18]=l=>pe())},"另存为新的主题"),v("mdui-button",{onClick:s[19]||(s[19]=l=>xe()),disabled:g(f)==g(A)},"应用该主题",8,jt),v("mdui-button",{onClick:s[20]||(s[20]=l=>Ie()),disabled:g(i).isGeneral},"删除主题",8,$t),g(F)?(M(),G("div",Wt,"保存失败。"+K(g(F)),1)):U("",!0)])):U("",!0),v("mdui-button",{onClick:s[21]||(s[21]=l=>ae())},"保存设置")]))}}),Qt=Je(_t,[["__scopeId","data-v-05822db1"]]);export{Qt as default};
