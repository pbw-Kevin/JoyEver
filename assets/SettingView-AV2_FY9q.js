import{T as Re,$ as q,U as Oe,V as W,W as Y,X as Se,Y as Be,Z as we,a0 as ee,a1 as Ee,a2 as te,a3 as Te,a4 as Ge,a5 as Me,a6 as Le,a7 as Pe,a8 as ze,a9 as Ne,aa as qe,ab as Fe,ac as Ve,ad as De,ae as je,s as oe,g as ue,h as ce,j as de,k as me,d as Ue,af as He,y as We,K as Ke,ag as se,ah as Qe,L as ae,ai as H,C as L,aj as ne,p as Xe,c as M,a as d,t as b,u as y,b as V,e as N,ak as _,F as ge,q as he,f as _e,v as Je,al as Ze,am as Ye,n as et,an as fe,S as j,ao as tt,ap as st,m as at,aq as nt,o as T,ar as ve,as as pe,at as it,_ as lt}from"./index-0UQCc8bI.js";import{_ as be}from"./UserTag.vue_vue_type_style_index_0_lang-WhtruuBO.js";const rt={onClick:W},ye="mdui.functions.dialog.";let J;const Ae=f=>{const e=new Re,t=q(e),n=["headline","description","icon","closeOnEsc","closeOnOverlayClick","stackedActions"],r=["onOpen","onOpened","onClose","onClosed","onOverlayClick"];return Object.entries(f).forEach(([o,u])=>{if(n.includes(o))e[o]=u;else if(r.includes(o)){const a=Oe(o.slice(2));t.on(a,m=>{m.target===e&&u.call(e,e)})}}),f.body&&t.append(f.body),f.actions&&f.actions.forEach(o=>{const u=Object.assign({},rt,o);q(`<mdui-button
        slot="action"
        variant="text"
      >${u.text}</mdui-button>`).appendTo(t).on("click",function(){const a=u.onClick.call(e,e);Y(a)?(this.loading=!0,a.then(()=>{e.open=!1}).finally(()=>{this.loading=!1})):a!==!1&&(e.open=!1)})}),t.appendTo("body").on("closed",o=>{o.target===e&&(t.remove(),f.queue&&(J=void 0,Se(ye+f.queue)))}),f.queue?J?Be(ye+f.queue,()=>{e.open=!0,J=e}):(setTimeout(()=>{e.open=!0}),J=e):setTimeout(()=>{e.open=!0}),e},Ie=()=>te("OK"),xe=()=>te("Cancel"),ot=f=>{const e=Object.assign({},{confirmText:Ie(),cancelText:xe(),onConfirm:W,onCancel:W},f),t=["headline","description","icon","closeOnEsc","closeOnOverlayClick","stackedActions","queue","onOpen","onOpened","onClose","onClosed","onOverlayClick"];return new Promise((n,r)=>{let o=!1;const u=Ae({...Object.fromEntries(t.filter(a=>!we(e[a])).map(a=>[a,e[a]])),actions:[{text:e.cancelText,onClick:a=>e.onCancel.call(a,a)},{text:e.confirmText,onClick:a=>{const m=e.onConfirm.call(a,a);return Y(m)?m.then(()=>{o=!0}):m!==!1&&(o=!0),m}}]});f.confirmText||ee(u,()=>{q(u).find('[slot="action"]').last().text(Ie())}),f.cancelText||ee(u,()=>{q(u).find('[slot="action"]').first().text(xe())}),q(u).on("close",a=>{a.target===u&&(o?n():r(),Ee(u))})})};class ut{fromInt(e){return Te(e)}toInt(e){return Ge(e[0],e[1],e[2])}distance(e,t){const n=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2];return n*n+r*r+o*o}}const ct=10,dt=3;class mt{static quantize(e,t,n){const r=new Map,o=new Array,u=new Array,a=new ut;let m=0;for(let i=0;i<e.length;i++){const g=e[i],C=r.get(g);C===void 0?(m++,o.push(a.fromInt(g)),u.push(g),r.set(g,1)):r.set(g,C+1)}const $=new Array;for(let i=0;i<m;i++){const g=u[i],C=r.get(g);C!==void 0&&($[i]=C)}let h=Math.min(n,m);t.length>0&&(h=Math.min(h,t.length));const I=new Array;for(let i=0;i<t.length;i++)I.push(a.fromInt(t[i]));const x=h-I.length;if(t.length===0&&x>0)for(let i=0;i<x;i++){const g=Math.random()*100,C=Math.random()*201+-100,z=Math.random()*201+-100;I.push(new Array(g,C,z))}const v=new Array;for(let i=0;i<m;i++)v.push(Math.floor(Math.random()*h));const w=new Array;for(let i=0;i<h;i++){w.push(new Array);for(let g=0;g<h;g++)w[i].push(0)}const E=new Array;for(let i=0;i<h;i++){E.push(new Array);for(let g=0;g<h;g++)E[i].push(new gt)}const R=new Array;for(let i=0;i<h;i++)R.push(0);for(let i=0;i<ct;i++){for(let p=0;p<h;p++){for(let k=p+1;k<h;k++){const G=a.distance(I[p],I[k]);E[k][p].distance=G,E[k][p].index=p,E[p][k].distance=G,E[p][k].index=k}E[p].sort();for(let k=0;k<h;k++)w[p][k]=E[p][k].index}let g=0;for(let p=0;p<m;p++){const k=o[p],G=v[p],S=I[G],D=a.distance(k,S);let K=D,Q=-1;for(let F=0;F<h;F++){if(E[G][F].distance>=4*D)continue;const U=a.distance(k,I[F]);U<K&&(K=U,Q=F)}Q!==-1&&Math.abs(Math.sqrt(K)-Math.sqrt(D))>dt&&(g++,v[p]=Q)}if(g===0&&i!==0)break;const C=new Array(h).fill(0),z=new Array(h).fill(0),O=new Array(h).fill(0);for(let p=0;p<h;p++)R[p]=0;for(let p=0;p<m;p++){const k=v[p],G=o[p],S=$[p];R[k]+=S,C[k]+=G[0]*S,z[k]+=G[1]*S,O[k]+=G[2]*S}for(let p=0;p<h;p++){const k=R[p];if(k===0){I[p]=[0,0,0];continue}const G=C[p]/k,S=z[p]/k,D=O[p]/k;I[p]=[G,S,D]}}const A=new Map;for(let i=0;i<h;i++){const g=R[i];if(g===0)continue;const C=a.toInt(I[i]);A.has(C)||A.set(C,g)}return A}}class gt{constructor(){this.distance=-1,this.index=-1}}class ht{static quantize(e){const t=new Map;for(let n=0;n<e.length;n++){const r=e[n];Me(r)<255||t.set(r,(t.get(r)??0)+1)}return t}}const Z=5,P=33,X=35937,B={RED:"red",GREEN:"green",BLUE:"blue"};class ft{constructor(e=[],t=[],n=[],r=[],o=[],u=[]){this.weights=e,this.momentsR=t,this.momentsG=n,this.momentsB=r,this.moments=o,this.cubes=u}quantize(e,t){this.constructHistogram(e),this.computeMoments();const n=this.createBoxes(t);return this.createResult(n.resultCount)}constructHistogram(e){this.weights=Array.from({length:X}).fill(0),this.momentsR=Array.from({length:X}).fill(0),this.momentsG=Array.from({length:X}).fill(0),this.momentsB=Array.from({length:X}).fill(0),this.moments=Array.from({length:X}).fill(0);const t=ht.quantize(e);for(const[n,r]of t.entries()){const o=Le(n),u=Pe(n),a=ze(n),m=8-Z,$=(o>>m)+1,h=(u>>m)+1,I=(a>>m)+1,x=this.getIndex($,h,I);this.weights[x]=(this.weights[x]??0)+r,this.momentsR[x]+=r*o,this.momentsG[x]+=r*u,this.momentsB[x]+=r*a,this.moments[x]+=r*(o*o+u*u+a*a)}}computeMoments(){for(let e=1;e<P;e++){const t=Array.from({length:P}).fill(0),n=Array.from({length:P}).fill(0),r=Array.from({length:P}).fill(0),o=Array.from({length:P}).fill(0),u=Array.from({length:P}).fill(0);for(let a=1;a<P;a++){let m=0,$=0,h=0,I=0,x=0;for(let v=1;v<P;v++){const w=this.getIndex(e,a,v);m+=this.weights[w],$+=this.momentsR[w],h+=this.momentsG[w],I+=this.momentsB[w],x+=this.moments[w],t[v]+=m,n[v]+=$,r[v]+=h,o[v]+=I,u[v]+=x;const E=this.getIndex(e-1,a,v);this.weights[w]=this.weights[E]+t[v],this.momentsR[w]=this.momentsR[E]+n[v],this.momentsG[w]=this.momentsG[E]+r[v],this.momentsB[w]=this.momentsB[E]+o[v],this.moments[w]=this.moments[E]+u[v]}}}}createBoxes(e){this.cubes=Array.from({length:e}).fill(0).map(()=>new vt);const t=Array.from({length:e}).fill(0);this.cubes[0].r0=0,this.cubes[0].g0=0,this.cubes[0].b0=0,this.cubes[0].r1=P-1,this.cubes[0].g1=P-1,this.cubes[0].b1=P-1;let n=e,r=0;for(let o=1;o<e;o++){this.cut(this.cubes[r],this.cubes[o])?(t[r]=this.cubes[r].vol>1?this.variance(this.cubes[r]):0,t[o]=this.cubes[o].vol>1?this.variance(this.cubes[o]):0):(t[r]=0,o--),r=0;let u=t[0];for(let a=1;a<=o;a++)t[a]>u&&(u=t[a],r=a);if(u<=0){n=o+1;break}}return new pt(e,n)}createResult(e){const t=[];for(let n=0;n<e;++n){const r=this.cubes[n],o=this.volume(r,this.weights);if(o>0){const u=Math.round(this.volume(r,this.momentsR)/o),a=Math.round(this.volume(r,this.momentsG)/o),m=Math.round(this.volume(r,this.momentsB)/o),$=255<<24|(u&255)<<16|(a&255)<<8|m&255;t.push($)}}return t}variance(e){const t=this.volume(e,this.momentsR),n=this.volume(e,this.momentsG),r=this.volume(e,this.momentsB),o=this.moments[this.getIndex(e.r1,e.g1,e.b1)]-this.moments[this.getIndex(e.r1,e.g1,e.b0)]-this.moments[this.getIndex(e.r1,e.g0,e.b1)]+this.moments[this.getIndex(e.r1,e.g0,e.b0)]-this.moments[this.getIndex(e.r0,e.g1,e.b1)]+this.moments[this.getIndex(e.r0,e.g1,e.b0)]+this.moments[this.getIndex(e.r0,e.g0,e.b1)]-this.moments[this.getIndex(e.r0,e.g0,e.b0)],u=t*t+n*n+r*r,a=this.volume(e,this.weights);return o-u/a}cut(e,t){const n=this.volume(e,this.momentsR),r=this.volume(e,this.momentsG),o=this.volume(e,this.momentsB),u=this.volume(e,this.weights),a=this.maximize(e,B.RED,e.r0+1,e.r1,n,r,o,u),m=this.maximize(e,B.GREEN,e.g0+1,e.g1,n,r,o,u),$=this.maximize(e,B.BLUE,e.b0+1,e.b1,n,r,o,u);let h;const I=a.maximum,x=m.maximum,v=$.maximum;if(I>=x&&I>=v){if(a.cutLocation<0)return!1;h=B.RED}else x>=I&&x>=v?h=B.GREEN:h=B.BLUE;switch(t.r1=e.r1,t.g1=e.g1,t.b1=e.b1,h){case B.RED:e.r1=a.cutLocation,t.r0=e.r1,t.g0=e.g0,t.b0=e.b0;break;case B.GREEN:e.g1=m.cutLocation,t.r0=e.r0,t.g0=e.g1,t.b0=e.b0;break;case B.BLUE:e.b1=$.cutLocation,t.r0=e.r0,t.g0=e.g0,t.b0=e.b1;break;default:throw new Error("unexpected direction "+h)}return e.vol=(e.r1-e.r0)*(e.g1-e.g0)*(e.b1-e.b0),t.vol=(t.r1-t.r0)*(t.g1-t.g0)*(t.b1-t.b0),!0}maximize(e,t,n,r,o,u,a,m){const $=this.bottom(e,t,this.momentsR),h=this.bottom(e,t,this.momentsG),I=this.bottom(e,t,this.momentsB),x=this.bottom(e,t,this.weights);let v=0,w=-1,E=0,R=0,A=0,i=0;for(let g=n;g<r;g++){if(E=$+this.top(e,t,g,this.momentsR),R=h+this.top(e,t,g,this.momentsG),A=I+this.top(e,t,g,this.momentsB),i=x+this.top(e,t,g,this.weights),i===0)continue;let C=(E*E+R*R+A*A)*1,z=i*1,O=C/z;E=o-E,R=u-R,A=a-A,i=m-i,i!==0&&(C=(E*E+R*R+A*A)*1,z=i*1,O+=C/z,O>v&&(v=O,w=g))}return new bt(w,v)}volume(e,t){return t[this.getIndex(e.r1,e.g1,e.b1)]-t[this.getIndex(e.r1,e.g1,e.b0)]-t[this.getIndex(e.r1,e.g0,e.b1)]+t[this.getIndex(e.r1,e.g0,e.b0)]-t[this.getIndex(e.r0,e.g1,e.b1)]+t[this.getIndex(e.r0,e.g1,e.b0)]+t[this.getIndex(e.r0,e.g0,e.b1)]-t[this.getIndex(e.r0,e.g0,e.b0)]}bottom(e,t,n){switch(t){case B.RED:return-n[this.getIndex(e.r0,e.g1,e.b1)]+n[this.getIndex(e.r0,e.g1,e.b0)]+n[this.getIndex(e.r0,e.g0,e.b1)]-n[this.getIndex(e.r0,e.g0,e.b0)];case B.GREEN:return-n[this.getIndex(e.r1,e.g0,e.b1)]+n[this.getIndex(e.r1,e.g0,e.b0)]+n[this.getIndex(e.r0,e.g0,e.b1)]-n[this.getIndex(e.r0,e.g0,e.b0)];case B.BLUE:return-n[this.getIndex(e.r1,e.g1,e.b0)]+n[this.getIndex(e.r1,e.g0,e.b0)]+n[this.getIndex(e.r0,e.g1,e.b0)]-n[this.getIndex(e.r0,e.g0,e.b0)];default:throw new Error("unexpected direction $direction")}}top(e,t,n,r){switch(t){case B.RED:return r[this.getIndex(n,e.g1,e.b1)]-r[this.getIndex(n,e.g1,e.b0)]-r[this.getIndex(n,e.g0,e.b1)]+r[this.getIndex(n,e.g0,e.b0)];case B.GREEN:return r[this.getIndex(e.r1,n,e.b1)]-r[this.getIndex(e.r1,n,e.b0)]-r[this.getIndex(e.r0,n,e.b1)]+r[this.getIndex(e.r0,n,e.b0)];case B.BLUE:return r[this.getIndex(e.r1,e.g1,n)]-r[this.getIndex(e.r1,e.g0,n)]-r[this.getIndex(e.r0,e.g1,n)]+r[this.getIndex(e.r0,e.g0,n)];default:throw new Error("unexpected direction $direction")}}getIndex(e,t,n){return(e<<Z*2)+(e<<Z+1)+e+(t<<Z)+t+n}}class vt{constructor(e=0,t=0,n=0,r=0,o=0,u=0,a=0){this.r0=e,this.r1=t,this.g0=n,this.g1=r,this.b0=o,this.b1=u,this.vol=a}}class pt{constructor(e,t){this.requestedCount=e,this.resultCount=t}}class bt{constructor(e,t){this.cutLocation=e,this.maximum=t}}class yt{static quantize(e,t){const r=new ft().quantize(e,t);return mt.quantize(e,r,t)}}async function It(f){const e=await new Promise((u,a)=>{const m=document.createElement("canvas"),$=m.getContext("2d");if(!$){a(new Error("Could not get canvas context"));return}const h=()=>{m.width=f.width,m.height=f.height,$.drawImage(f,0,0);let x=[0,0,f.width,f.height];const v=f.dataset.area;v&&/^\d+(\s*,\s*\d+){3}$/.test(v)&&(x=v.split(/\s*,\s*/).map(i=>parseInt(i,10)));const[w,E,R,A]=x;u($.getImageData(w,E,R,A).data)},I=()=>{a(new Error("Image load failed"))};f.complete?h():(f.onload=h,f.onerror=I)}),t=[];for(let u=0;u<e.length;u+=4){const a=e[u],m=e[u+1],$=e[u+2];if(e[u+3]<255)continue;const I=qe(a,m,$);t.push(I)}const n=yt.quantize(t,128);return Ne.score(n)[0]}const xt=async f=>{const e=q(f),t=await It(e[0]);return Fe(t)},ke=()=>te("OK"),Ce=()=>te("Cancel"),kt=f=>{const e=Object.assign({},{confirmText:ke(),cancelText:Ce(),onConfirm:W,onCancel:W,validator:W,textFieldOptions:{}},f),t=["headline","description","icon","closeOnEsc","closeOnOverlayClick","stackedActions","queue","onOpen","onOpened","onClose","onClosed","onOverlayClick"],n=new Ve;return Object.entries(e.textFieldOptions).forEach(([r,o])=>{n[r]=o}),new Promise((r,o)=>{let u=!1;const a=Ae({...Object.fromEntries(t.filter(m=>!we(e[m])).map(m=>[m,e[m]])),body:n,actions:[{text:e.cancelText,onClick:m=>e.onCancel.call(m,n.value,m)},{text:e.confirmText,onClick:m=>{const $=()=>{const I=e.onConfirm.call(m,n.value,m);return Y(I)?I.then(()=>{u=!0}):I!==!1&&(u=!0),I};if(n.setCustomValidity(""),!n.reportValidity())return!1;const h=e.validator.call(n,n.value);return De(h)&&!h?(n.setCustomValidity(" "),!1):je(h)?(n.setCustomValidity(h),!1):Y(h)?new Promise((I,x)=>{h.then(I).catch(v=>{n.setCustomValidity(v),x(v)})}):$()}}]});f.confirmText||ee(a,()=>{q(a).find('[slot="action"]').last().text(ke())}),f.cancelText||ee(a,()=>{q(a).find('[slot="action"]').first().text(Ce())}),q(a).on("close",m=>{m.target===a&&(u?r(n.value):o(),Ee(a))})})};let ie=class extends de{render(){return me('<path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>')}};ie.styles=oe;ie=ue([ce("mdui-icon-settings")],ie);let le=class extends de{render(){return me('<path d="M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>')}};le.styles=oe;le=ue([ce("mdui-icon-security")],le);let re=class extends de{render(){return me('<path d="M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10a2.5 2.5 0 0 0 2.5-2.5c0-.61-.23-1.2-.64-1.67a.528.528 0 0 1-.13-.33c0-.28.22-.5.5-.5H16c3.31 0 6-2.69 6-6 0-4.96-4.49-9-10-9zm5.5 11c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm-3-4c-.83 0-1.5-.67-1.5-1.5S13.67 6 14.5 6s1.5.67 1.5 1.5S15.33 9 14.5 9zM5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S7.33 13 6.5 13 5 12.33 5 11.5zm6-4c0 .83-.67 1.5-1.5 1.5S8 8.33 8 7.5 8.67 6 9.5 6s1.5.67 1.5 1.5z"/>')}};re.styles=oe;re=ue([ce("mdui-icon-palette")],re);const Ct={class:"content"},wt=["disabled"],Et={value:"global","full-width":"",variant:"secondary"},At={value:"global"},$t={value:"security"},Rt={value:"game"},Ot={value:"appearance"},St={slot:"panel",value:"global"},Bt=["label","value"],Tt=["label","value"],Gt=["label","value"],Mt={slot:"helper",class:"error-info"},Lt=["disabled"],Pt=["checked"],zt={key:1},Nt=["disabled"],qt={key:1},Ft={key:2},Vt={slot:"panel",value:"security"},Dt=["label","value"],jt={slot:"helper",class:"error-info"},Ut=["label","value"],Ht={slot:"helper",class:"error-info"},Wt={slot:"panel",value:"game"},Kt={slot:"panel",value:"appearance"},Qt=["label","value"],Xt=["value"],_t={key:0,class:"appearance-card"},Jt=["label","value"],Zt=["label","value"],Yt=["value"],es=["label","value"],ts={class:"color-scheme"},ss=["disabled"],as={key:1,class:"error-info"},ns={key:2},is=["value"],ls=["value"],rs=["disabled"],os=["disabled"],us=["disabled"],cs={key:3,class:"error-info"},ds=Ue({__name:"SettingView",setup(f){const e=at(),{t}=He();We();var n=Ke(),r=n.getUsername(),o=new se.Object("UserInfo"),u=new se.Object("Email");const a=Qe({nickname:"",email:n.get("email")||"",hasEmail:!!n.get("email"),emailChanged:!1,isPublicEmail:!1,isVerifiedEmail:n.get("emailVerified")||!1,verifyEmailClicked:!1,verifyEmailFailed:!1,emailErrorInfo:""});ae.get("userInfo").then(s=>{s&&(o=s,a.nickname=o.get("nickname"))}),ae.get("email").then(s=>{s&&(u=s,a.isPublicEmail=s.getACL()?.getPublicReadAccess())});function m(){j(t("setting.message.failedAutoSave"),!0)}H(()=>a.nickname,ve(s=>{s&&(o.set("nickname",s),o.save().catch(()=>{m()}))},1e3)),H(()=>a.email,s=>{a.emailErrorInfo="",a.hasEmail=!!s,a.emailChanged=s!==n.get("email"),s&&!fe(s)&&(a.emailErrorInfo=t("setting.message.incorrectEmailFormat"))});function $(){if(a.emailErrorInfo="",a.email&&!fe(a.email)){a.emailErrorInfo=t("setting.message.incorrectEmailFormat");return}n.setEmail(a.email),n.save().then(s=>(a.isVerifiedEmail=s.get("emailVerified"),u.set("email",a.email))).then(()=>{a.emailChanged=!1,j(t("setting.message.emailSaved"),!0)}).catch(s=>{if(s.code==203){a.emailErrorInfo=t("setting.message.emailUsed");return}a.emailErrorInfo=t("setting.message.failedSaveEmail")}),a.verifyEmailClicked=!1,a.verifyEmailFailed=!1}function h(s){a.isPublicEmail=s,u.getACL().setPublicReadAccess(s),u.save().then(()=>{j(t("setting.message.emailPublicChanged"),!0)}).catch(l=>{j(t("setting.message.failedChangeEmailPublic"),!0)})}function I(){se.User.requestEmailVerify(a.email).then(()=>{a.verifyEmailClicked=!0}).catch(s=>{a.verifyEmailFailed=!0})}var x=L(""),v=L(""),w=L({password:"",passwordAgain:""}),E=L(!1);function R(){if(w.value={password:"",passwordAgain:""},E.value=!1,x.value)if(tt(x.value))if(x.value!==v.value){w.value.passwordAgain=t("setting.message.differentPassword");return}else n.setPassword(x.value),n.save().then(()=>{j(t("setting.security.password.message.changed")),st(!1),e.push({name:"Login"})}).catch(()=>{w.value.password=t("setting.message.failedSave")});else{w.value.password=t("setting.message.incorrectPasswordFormat");return}else{w.value.password=t("setting.message.emptyPassword");return}}var A=L(pe),i=L({...ne.value}),g=L(i.value.name),C=L(i.value.name),z=Xe(()=>JSON.stringify(A.value.find(s=>s.name===g.value))!==JSON.stringify(i.value));H(it,s=>{s&&(A.value=pe,i.value={...ne.value},g.value=i.value.name,C.value=i.value.name)});var O=L(i.value.backgroundImage);H(g,s=>{var l=A.value.find(c=>c.name===s);l&&(i.value={...l},O.value=l.backgroundImage)}),H(i,s=>{ne.value={...s}},{deep:!0});var p=ve(s=>{i.value.backgroundImage=s},1e3);H(O,(s,l)=>{s?l?p(s):(i.value.backgroundImageOpacity=.3,i.value.sidebarOpacity=.7,i.value.backgroundImage=s):(i.value.backgroundImageOpacity=0,i.value.sidebarOpacity=1)});var k=L("");function G(){k.value="";var s=new Image;s.src=i.value.backgroundImage,s.crossOrigin="anonymous",s.onload=()=>{xt(s).then(l=>{i.value.colorScheme=l}).catch(l=>{k.value=l.message})},s.onerror=l=>{k.value=t("setting.message.failedLoadBackgroundImage")}}var S=L("");function D(){S.value="";var s=A.value.find(c=>c.name===g.value);if(s){var l=A.value.find(c=>c.name===i.value.name);if(l&&l!==s){S.value="主题名已存在。";return}Object.assign(s,{...i.value})}else A.value.push({...i.value});C.value===g.value&&(C.value=i.value.name),g.value=i.value.name}function K(){kt({headline:"另存为新的主题",description:"在此处键入主题名。",confirmText:"完成",cancelText:"取消",onConfirm:s=>{if(!s){S.value="主题名不能为空。";return}if(A.value.some(c=>c.name===s)){S.value="主题名已存在。";return}var l={...i.value,name:s,isGeneral:!1};A.value.push(l),g.value=s}})}function Q(){C.value=g.value,nt(i.value)}function F(){ot({headline:"确认要删除主题吗？",description:"此操作不可撤销。",confirmText:"删除",cancelText:"取消",onConfirm:()=>{A.value=A.value.filter(s=>s.name!==g.value),g.value==C.value&&(C.value=A.value.find(s=>s.isGeneral)?.name||""),g.value=C.value}})}var U=L(!1);async function $e(){U.value=!0;var s=!1;await n.save().catch(l=>{s=!0}),await o.save().catch(l=>{s=!0}),await u.save().catch(l=>{s=!0}),await ae.get("privateUserInfo").then(async l=>{if(!l){s=!0;return}l.set("customAppearance",A.value.filter(c=>!c.isGeneral).map(c=>({name:c.name,theme:c.theme,backgroundImage:c.backgroundImage,colorScheme:c.colorScheme,backgroundImageOpacity:c.backgroundImageOpacity,sidebarOpacity:c.sidebarOpacity}))),l.set("activeAppearance",C.value),await l.save().catch(c=>{s=!0})}),s?j(t("setting.message.failedSave"),!0):j(t("setting.message.saved"),!0),U.value=!1}return(s,l)=>(T(),M("div",Ct,[d("h1",null,b(s.$t("setting.title")),1),d("mdui-button",{onClick:l[0]||(l[0]=c=>$e()),disabled:y(U)},b(s.$t("setting.operation.save")),9,wt),d("mdui-tabs",Et,[d("mdui-tab",At,[V(b(s.$t("setting.global.title"))+" ",1),l[21]||(l[21]=d("mdui-icon-settings",{slot:"icon"},null,-1))]),d("mdui-tab",$t,[V(b(s.$t("setting.security.title"))+" ",1),l[22]||(l[22]=d("mdui-icon-security",{slot:"icon"},null,-1))]),d("mdui-tab",Rt,[V(b(s.$t("setting.game.title"))+" ",1),l[23]||(l[23]=d("mdui-icon-videogame-asset",{slot:"icon"},null,-1))]),d("mdui-tab",Ot,[V(b(s.$t("setting.appearance.title"))+" ",1),l[24]||(l[24]=d("mdui-icon-palette",{slot:"icon"},null,-1))]),d("mdui-tab-panel",St,[d("h2",null,b(s.$t("setting.global.title")),1),d("mdui-text-field",{label:s.$t("setting.global.username.title"),variant:"outlined",readonly:"",value:y(r)},null,8,Bt),d("mdui-text-field",{label:s.$t("setting.global.nickname.title"),value:a.nickname,onInput:l[1]||(l[1]=c=>a.nickname=c.target.value),required:""},null,40,Tt),d("h3",null,b(s.$t("setting.global.email.title")),1),d("mdui-text-field",{type:"email",label:s.$t("setting.global.email.title"),value:a.email,onInput:l[2]||(l[2]=c=>a.email=c.target.value)},[d("span",Mt,b(a.emailErrorInfo),1)],40,Gt),d("mdui-button",{disabled:!a.emailChanged,onClick:l[3]||(l[3]=c=>$())},b(s.$t("setting.global.email.operation.save")),9,Lt),a.hasEmail?(T(),M("mdui-checkbox",{key:0,checked:a.isPublicEmail,onInput:l[4]||(l[4]=c=>h(!c.target.checked))},b(s.$t("setting.global.email.operation.madePublic")),41,Pt)):N("",!0),a.hasEmail?(T(),M("div",zt,[V(b(s.$t("setting.global.email.status.title",{status:a.isVerifiedEmail?s.$t("setting.global.email.status.verified"):s.$t("setting.global.email.status.unverified")}))+" ",1),a.isVerifiedEmail?N("",!0):(T(),M("mdui-button",{key:0,onClick:l[5]||(l[5]=c=>I()),disabled:!a.emailChanged&&a.hasEmail&&a.verifyEmailClicked},b(s.$t("setting.global.email.operation.verify")),9,Nt)),a.verifyEmailClicked?(T(),M("span",qt,b(s.$t("setting.global.email.status.message.clicked")),1)):N("",!0),a.verifyEmailFailed?(T(),M("span",Ft,b(s.$t("setting.global.email.status.message.failed")),1)):N("",!0)])):N("",!0)]),d("mdui-tab-panel",Vt,[d("h2",null,b(s.$t("setting.security.title")),1),d("h3",null,b(s.$t("setting.security.password.change.title")),1),d("mdui-text-field",{type:"password","toggle-password":"",label:s.$t("setting.security.password.new.title"),value:y(x),onInput:l[6]||(l[6]=c=>_(x)?x.value=c.target.value:x=c.target.value)},[d("span",jt,b(y(w).password),1)],40,Dt),d("mdui-text-field",{type:"password","toggle-password":"",label:s.$t("setting.security.password.ensureNew.title"),value:y(v),onInput:l[7]||(l[7]=c=>_(v)?v.value=c.target.value:v=c.target.value)},[d("span",Ht,b(y(w).passwordAgain),1)],40,Ut),d("mdui-button",{onClick:l[8]||(l[8]=c=>R())},b(s.$t("setting.security.password.operation.change")),1)]),d("mdui-tab-panel",Wt,[d("h2",null,b(s.$t("setting.game.title")),1),d("mdui-checkbox",null,b(s.$t("setting.game.madeHistoryPublic.title")),1),l[25]||(l[25]=d("br",null,null,-1)),d("mdui-checkbox",null,b(s.$t("setting.game.autoDisableUnavailableSkill.title")),1),d("h3",null,b(s.$t("setting.game.customSkill.title")),1),d("p",null,b(s.$t("setting.game.customSkill.disc")),1)]),d("mdui-tab-panel",Kt,[d("h2",null,b(s.$t("setting.appearance.title")),1),d("h3",null,b(s.$t("setting.appearance.theme.title")),1),d("mdui-select",{label:s.$t("setting.appearance.theme.select.title"),value:y(g),onChange:l[9]||(l[9]=c=>_(g)?g.value=c.target.value:g=c.target.value)},[(T(!0),M(ge,null,he(y(A),c=>(T(),M("mdui-menu-item",{value:c.name},b(c.name),9,Xt))),256)),l[26]||(l[26]=d("mdui-button-icon",{slot:"end-icon"},[d("mdui-icon-keyboard-arrow-down")],-1))],40,Qt),y(g)?(T(),M("mdui-card",_t,[_e(be,{color:"grey",tag:y(i).isGeneral?s.$t("setting.appearance.theme.type.general"):s.$t("setting.appearance.theme.type.custom")},null,8,["tag"]),y(g)==y(C)?(T(),Je(be,{key:0,color:"green",tag:s.$t("setting.appearance.theme.applied.title")},null,8,["tag"])):N("",!0),d("mdui-text-field",{label:s.$t("setting.appearance.theme.name.title"),value:y(i).name,onInput:l[10]||(l[10]=c=>y(i).name=c.target.value)},null,40,Jt),d("mdui-select",{label:s.$t("setting.appearance.theme.lightDark.title"),value:y(i).theme,onChange:l[11]||(l[11]=c=>y(i).theme=c.target.value)},[(T(),M(ge,null,he(["auto","light","dark"],c=>d("mdui-menu-item",{value:c},b(s.$t("setting.appearance.theme.lightDark."+c)),9,Yt)),64)),l[27]||(l[27]=d("mdui-button-icon",{slot:"end-icon"},[d("mdui-icon-keyboard-arrow-down")],-1))],40,Zt),d("mdui-text-field",{label:s.$t("setting.appearance.theme.backgroundImage.title"),value:y(O),onInput:l[12]||(l[12]=c=>_(O)?O.value=c.target.value:O=c.target.value)},null,40,es),d("div",ts,[V(b(s.$t("setting.appearance.theme.colorScheme.title")),1),Ze(d("input",{type:"color","onUpdate:modelValue":l[13]||(l[13]=c=>y(i).colorScheme=c),style:{"margin-left":"4px"}},null,512),[[Ye,y(i).colorScheme]]),d("mdui-button",{onClick:l[14]||(l[14]=c=>G()),disabled:!y(O)||!y(i).backgroundImage},b(s.$t("setting.appearance.theme.colorScheme.getColorFromImage")),9,ss)]),y(k)?(T(),M("div",as,b(s.$t("setting.appearance.theme.colorScheme.error",{colorErrorInfo:y(k)})),1)):N("",!0),y(O)?(T(),M("div",ns,[V(b(s.$t("setting.appearance.theme.opacity.backgroundImage"))+" ",1),d("mdui-slider",{tickmarks:"",max:"10",step:"1",value:y(i).backgroundImageOpacity*10,onInput:l[15]||(l[15]=c=>y(i).backgroundImageOpacity=c.target.value/10)},null,40,is),V(" "+b(s.$t("setting.appearance.theme.opacity.sidebar"))+" ",1),d("mdui-slider",{tickmarks:"",max:"10",step:"1",value:y(i).sidebarOpacity*10,onInput:l[16]||(l[16]=c=>y(i).sidebarOpacity=c.target.value/10)},null,40,ls)])):N("",!0),d("mdui-button",{onClick:l[17]||(l[17]=c=>D()),disabled:!y(z)||y(i).isGeneral},b(s.$t("setting.appearance.theme.operation.save")),9,rs),d("mdui-button",{onClick:l[18]||(l[18]=c=>K())},b(s.$t("setting.appearance.theme.operation.saveAs")),1),d("mdui-button",{onClick:l[19]||(l[19]=c=>Q()),disabled:y(g)==y(C)},b(s.$t("setting.appearance.theme.operation.apply")),9,os),d("mdui-button",{onClick:l[20]||(l[20]=c=>F()),disabled:y(i).isGeneral,style:et({backgroundColor:y(i).isGeneral?"":"rgb(var(--mdui-color-error))"})},b(s.$t("setting.appearance.theme.operation.delete")),13,us),y(S)?(T(),M("div",cs,b(s.$t("setting.appearance.theme.message.failedSave",{savingErrorInfo:y(S)})),1)):N("",!0)])):N("",!0)])])]))}}),ps=lt(ds,[["__scopeId","data-v-49aac2ec"]]);export{ps as default};
