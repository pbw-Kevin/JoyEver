import{T as Ae,$ as q,U as $e,V as j,W as Z,X as Re,Y as Oe,Z as Ce,a0 as Y,a1 as ke,a2 as ee,a3 as Se,a4 as Be,a5 as Te,a6 as Ge,a7 as Me,a8 as Le,a9 as Pe,aa as ze,ab as qe,ac as Fe,ad as Ne,ae as Ve,s as le,g as re,h as oe,j as ce,k as ue,d as De,af as je,y as Ue,K as He,ag as Q,ah as de,ai as me,C as F,aj as _,L as te,ak as D,p as We,c as T,a as m,t as b,b as N,e as z,u as x,al as se,F as ge,q as he,f as Ke,v as Qe,am as _e,an as Xe,n as Je,ao as fe,S as W,ap as Ze,aq as Ye,m as et,ar as tt,o as B,as as st,at,_ as nt}from"./index-oBlj-0q0.js";import{_ as pe}from"./UserTag.vue_vue_type_style_index_0_lang-DUvwC42s.js";const it={onClick:j},ve="mdui.functions.dialog.";let X;const Ee=f=>{const e=new Ae,t=q(e),a=["headline","description","icon","closeOnEsc","closeOnOverlayClick","stackedActions"],o=["onOpen","onOpened","onClose","onClosed","onOverlayClick"];return Object.entries(f).forEach(([c,u])=>{if(a.includes(c))e[c]=u;else if(o.includes(c)){const i=$e(c.slice(2));t.on(i,n=>{n.target===e&&u.call(e,e)})}}),f.body&&t.append(f.body),f.actions&&f.actions.forEach(c=>{const u=Object.assign({},it,c);q(`<mdui-button
        slot="action"
        variant="text"
      >${u.text}</mdui-button>`).appendTo(t).on("click",function(){const i=u.onClick.call(e,e);Z(i)?(this.loading=!0,i.then(()=>{e.open=!1}).finally(()=>{this.loading=!1})):i!==!1&&(e.open=!1)})}),t.appendTo("body").on("closed",c=>{c.target===e&&(t.remove(),f.queue&&(X=void 0,Re(ve+f.queue)))}),f.queue?X?Oe(ve+f.queue,()=>{e.open=!0,X=e}):(setTimeout(()=>{e.open=!0}),X=e):setTimeout(()=>{e.open=!0}),e},be=()=>ee("OK"),Ie=()=>ee("Cancel"),lt=f=>{const e=Object.assign({},{confirmText:be(),cancelText:Ie(),onConfirm:j,onCancel:j},f),t=["headline","description","icon","closeOnEsc","closeOnOverlayClick","stackedActions","queue","onOpen","onOpened","onClose","onClosed","onOverlayClick"];return new Promise((a,o)=>{let c=!1;const u=Ee({...Object.fromEntries(t.filter(i=>!Ce(e[i])).map(i=>[i,e[i]])),actions:[{text:e.cancelText,onClick:i=>e.onCancel.call(i,i)},{text:e.confirmText,onClick:i=>{const n=e.onConfirm.call(i,i);return Z(n)?n.then(()=>{c=!0}):n!==!1&&(c=!0),n}}]});f.confirmText||Y(u,()=>{q(u).find('[slot="action"]').last().text(be())}),f.cancelText||Y(u,()=>{q(u).find('[slot="action"]').first().text(Ie())}),q(u).on("close",i=>{i.target===u&&(c?a():o(),ke(u))})})};class rt{fromInt(e){return Se(e)}toInt(e){return Be(e[0],e[1],e[2])}distance(e,t){const a=e[0]-t[0],o=e[1]-t[1],c=e[2]-t[2];return a*a+o*o+c*c}}const ot=10,ct=3;class ut{static quantize(e,t,a){const o=new Map,c=new Array,u=new Array,i=new rt;let n=0;for(let d=0;d<e.length;d++){const C=e[d],R=o.get(C);R===void 0?(n++,c.push(i.fromInt(C)),u.push(C),o.set(C,1)):o.set(C,R+1)}const I=new Array;for(let d=0;d<n;d++){const C=u[d],R=o.get(C);R!==void 0&&(I[d]=R)}let l=Math.min(a,n);t.length>0&&(l=Math.min(l,t.length));const g=new Array;for(let d=0;d<t.length;d++)g.push(i.fromInt(t[d]));const E=l-g.length;if(t.length===0&&E>0)for(let d=0;d<E;d++){const C=Math.random()*100,R=Math.random()*201+-100,L=Math.random()*201+-100;g.push(new Array(C,R,L))}const y=new Array;for(let d=0;d<n;d++)y.push(Math.floor(Math.random()*l));const A=new Array;for(let d=0;d<l;d++){A.push(new Array);for(let C=0;C<l;C++)A[d].push(0)}const k=new Array;for(let d=0;d<l;d++){k.push(new Array);for(let C=0;C<l;C++)k[d].push(new dt)}const w=new Array;for(let d=0;d<l;d++)w.push(0);for(let d=0;d<ot;d++){for(let p=0;p<l;p++){for(let v=p+1;v<l;v++){const S=i.distance(g[p],g[v]);k[v][p].distance=S,k[v][p].index=p,k[p][v].distance=S,k[p][v].index=v}k[p].sort();for(let v=0;v<l;v++)A[p][v]=k[p][v].index}let C=0;for(let p=0;p<n;p++){const v=c[p],S=y[p],P=g[S],V=i.distance(v,P);let U=V,H=-1;for(let s=0;s<l;s++){if(k[S][s].distance>=4*V)continue;const r=i.distance(v,g[s]);r<U&&(U=r,H=s)}H!==-1&&Math.abs(Math.sqrt(U)-Math.sqrt(V))>ct&&(C++,y[p]=H)}if(C===0&&d!==0)break;const R=new Array(l).fill(0),L=new Array(l).fill(0),G=new Array(l).fill(0);for(let p=0;p<l;p++)w[p]=0;for(let p=0;p<n;p++){const v=y[p],S=c[p],P=I[p];w[v]+=P,R[v]+=S[0]*P,L[v]+=S[1]*P,G[v]+=S[2]*P}for(let p=0;p<l;p++){const v=w[p];if(v===0){g[p]=[0,0,0];continue}const S=R[p]/v,P=L[p]/v,V=G[p]/v;g[p]=[S,P,V]}}const $=new Map;for(let d=0;d<l;d++){const C=w[d];if(C===0)continue;const R=i.toInt(g[d]);$.has(R)||$.set(R,C)}return $}}class dt{constructor(){this.distance=-1,this.index=-1}}class mt{static quantize(e){const t=new Map;for(let a=0;a<e.length;a++){const o=e[a];Te(o)<255||t.set(o,(t.get(o)??0)+1)}return t}}const J=5,M=33,K=35937,O={RED:"red",GREEN:"green",BLUE:"blue"};class gt{constructor(e=[],t=[],a=[],o=[],c=[],u=[]){this.weights=e,this.momentsR=t,this.momentsG=a,this.momentsB=o,this.moments=c,this.cubes=u}quantize(e,t){this.constructHistogram(e),this.computeMoments();const a=this.createBoxes(t);return this.createResult(a.resultCount)}constructHistogram(e){this.weights=Array.from({length:K}).fill(0),this.momentsR=Array.from({length:K}).fill(0),this.momentsG=Array.from({length:K}).fill(0),this.momentsB=Array.from({length:K}).fill(0),this.moments=Array.from({length:K}).fill(0);const t=mt.quantize(e);for(const[a,o]of t.entries()){const c=Ge(a),u=Me(a),i=Le(a),n=8-J,I=(c>>n)+1,l=(u>>n)+1,g=(i>>n)+1,E=this.getIndex(I,l,g);this.weights[E]=(this.weights[E]??0)+o,this.momentsR[E]+=o*c,this.momentsG[E]+=o*u,this.momentsB[E]+=o*i,this.moments[E]+=o*(c*c+u*u+i*i)}}computeMoments(){for(let e=1;e<M;e++){const t=Array.from({length:M}).fill(0),a=Array.from({length:M}).fill(0),o=Array.from({length:M}).fill(0),c=Array.from({length:M}).fill(0),u=Array.from({length:M}).fill(0);for(let i=1;i<M;i++){let n=0,I=0,l=0,g=0,E=0;for(let y=1;y<M;y++){const A=this.getIndex(e,i,y);n+=this.weights[A],I+=this.momentsR[A],l+=this.momentsG[A],g+=this.momentsB[A],E+=this.moments[A],t[y]+=n,a[y]+=I,o[y]+=l,c[y]+=g,u[y]+=E;const k=this.getIndex(e-1,i,y);this.weights[A]=this.weights[k]+t[y],this.momentsR[A]=this.momentsR[k]+a[y],this.momentsG[A]=this.momentsG[k]+o[y],this.momentsB[A]=this.momentsB[k]+c[y],this.moments[A]=this.moments[k]+u[y]}}}}createBoxes(e){this.cubes=Array.from({length:e}).fill(0).map(()=>new ht);const t=Array.from({length:e}).fill(0);this.cubes[0].r0=0,this.cubes[0].g0=0,this.cubes[0].b0=0,this.cubes[0].r1=M-1,this.cubes[0].g1=M-1,this.cubes[0].b1=M-1;let a=e,o=0;for(let c=1;c<e;c++){this.cut(this.cubes[o],this.cubes[c])?(t[o]=this.cubes[o].vol>1?this.variance(this.cubes[o]):0,t[c]=this.cubes[c].vol>1?this.variance(this.cubes[c]):0):(t[o]=0,c--),o=0;let u=t[0];for(let i=1;i<=c;i++)t[i]>u&&(u=t[i],o=i);if(u<=0){a=c+1;break}}return new ft(e,a)}createResult(e){const t=[];for(let a=0;a<e;++a){const o=this.cubes[a],c=this.volume(o,this.weights);if(c>0){const u=Math.round(this.volume(o,this.momentsR)/c),i=Math.round(this.volume(o,this.momentsG)/c),n=Math.round(this.volume(o,this.momentsB)/c),I=255<<24|(u&255)<<16|(i&255)<<8|n&255;t.push(I)}}return t}variance(e){const t=this.volume(e,this.momentsR),a=this.volume(e,this.momentsG),o=this.volume(e,this.momentsB),c=this.moments[this.getIndex(e.r1,e.g1,e.b1)]-this.moments[this.getIndex(e.r1,e.g1,e.b0)]-this.moments[this.getIndex(e.r1,e.g0,e.b1)]+this.moments[this.getIndex(e.r1,e.g0,e.b0)]-this.moments[this.getIndex(e.r0,e.g1,e.b1)]+this.moments[this.getIndex(e.r0,e.g1,e.b0)]+this.moments[this.getIndex(e.r0,e.g0,e.b1)]-this.moments[this.getIndex(e.r0,e.g0,e.b0)],u=t*t+a*a+o*o,i=this.volume(e,this.weights);return c-u/i}cut(e,t){const a=this.volume(e,this.momentsR),o=this.volume(e,this.momentsG),c=this.volume(e,this.momentsB),u=this.volume(e,this.weights),i=this.maximize(e,O.RED,e.r0+1,e.r1,a,o,c,u),n=this.maximize(e,O.GREEN,e.g0+1,e.g1,a,o,c,u),I=this.maximize(e,O.BLUE,e.b0+1,e.b1,a,o,c,u);let l;const g=i.maximum,E=n.maximum,y=I.maximum;if(g>=E&&g>=y){if(i.cutLocation<0)return!1;l=O.RED}else E>=g&&E>=y?l=O.GREEN:l=O.BLUE;switch(t.r1=e.r1,t.g1=e.g1,t.b1=e.b1,l){case O.RED:e.r1=i.cutLocation,t.r0=e.r1,t.g0=e.g0,t.b0=e.b0;break;case O.GREEN:e.g1=n.cutLocation,t.r0=e.r0,t.g0=e.g1,t.b0=e.b0;break;case O.BLUE:e.b1=I.cutLocation,t.r0=e.r0,t.g0=e.g0,t.b0=e.b1;break;default:throw new Error("unexpected direction "+l)}return e.vol=(e.r1-e.r0)*(e.g1-e.g0)*(e.b1-e.b0),t.vol=(t.r1-t.r0)*(t.g1-t.g0)*(t.b1-t.b0),!0}maximize(e,t,a,o,c,u,i,n){const I=this.bottom(e,t,this.momentsR),l=this.bottom(e,t,this.momentsG),g=this.bottom(e,t,this.momentsB),E=this.bottom(e,t,this.weights);let y=0,A=-1,k=0,w=0,$=0,d=0;for(let C=a;C<o;C++){if(k=I+this.top(e,t,C,this.momentsR),w=l+this.top(e,t,C,this.momentsG),$=g+this.top(e,t,C,this.momentsB),d=E+this.top(e,t,C,this.weights),d===0)continue;let R=(k*k+w*w+$*$)*1,L=d*1,G=R/L;k=c-k,w=u-w,$=i-$,d=n-d,d!==0&&(R=(k*k+w*w+$*$)*1,L=d*1,G+=R/L,G>y&&(y=G,A=C))}return new pt(A,y)}volume(e,t){return t[this.getIndex(e.r1,e.g1,e.b1)]-t[this.getIndex(e.r1,e.g1,e.b0)]-t[this.getIndex(e.r1,e.g0,e.b1)]+t[this.getIndex(e.r1,e.g0,e.b0)]-t[this.getIndex(e.r0,e.g1,e.b1)]+t[this.getIndex(e.r0,e.g1,e.b0)]+t[this.getIndex(e.r0,e.g0,e.b1)]-t[this.getIndex(e.r0,e.g0,e.b0)]}bottom(e,t,a){switch(t){case O.RED:return-a[this.getIndex(e.r0,e.g1,e.b1)]+a[this.getIndex(e.r0,e.g1,e.b0)]+a[this.getIndex(e.r0,e.g0,e.b1)]-a[this.getIndex(e.r0,e.g0,e.b0)];case O.GREEN:return-a[this.getIndex(e.r1,e.g0,e.b1)]+a[this.getIndex(e.r1,e.g0,e.b0)]+a[this.getIndex(e.r0,e.g0,e.b1)]-a[this.getIndex(e.r0,e.g0,e.b0)];case O.BLUE:return-a[this.getIndex(e.r1,e.g1,e.b0)]+a[this.getIndex(e.r1,e.g0,e.b0)]+a[this.getIndex(e.r0,e.g1,e.b0)]-a[this.getIndex(e.r0,e.g0,e.b0)];default:throw new Error("unexpected direction $direction")}}top(e,t,a,o){switch(t){case O.RED:return o[this.getIndex(a,e.g1,e.b1)]-o[this.getIndex(a,e.g1,e.b0)]-o[this.getIndex(a,e.g0,e.b1)]+o[this.getIndex(a,e.g0,e.b0)];case O.GREEN:return o[this.getIndex(e.r1,a,e.b1)]-o[this.getIndex(e.r1,a,e.b0)]-o[this.getIndex(e.r0,a,e.b1)]+o[this.getIndex(e.r0,a,e.b0)];case O.BLUE:return o[this.getIndex(e.r1,e.g1,a)]-o[this.getIndex(e.r1,e.g0,a)]-o[this.getIndex(e.r0,e.g1,a)]+o[this.getIndex(e.r0,e.g0,a)];default:throw new Error("unexpected direction $direction")}}getIndex(e,t,a){return(e<<J*2)+(e<<J+1)+e+(t<<J)+t+a}}class ht{constructor(e=0,t=0,a=0,o=0,c=0,u=0,i=0){this.r0=e,this.r1=t,this.g0=a,this.g1=o,this.b0=c,this.b1=u,this.vol=i}}class ft{constructor(e,t){this.requestedCount=e,this.resultCount=t}}class pt{constructor(e,t){this.cutLocation=e,this.maximum=t}}class vt{static quantize(e,t){const o=new gt().quantize(e,t);return ut.quantize(e,o,t)}}async function bt(f){const e=await new Promise((u,i)=>{const n=document.createElement("canvas"),I=n.getContext("2d");if(!I){i(new Error("Could not get canvas context"));return}const l=()=>{n.width=f.width,n.height=f.height,I.drawImage(f,0,0);let E=[0,0,f.width,f.height];const y=f.dataset.area;y&&/^\d+(\s*,\s*\d+){3}$/.test(y)&&(E=y.split(/\s*,\s*/).map(d=>parseInt(d,10)));const[A,k,w,$]=E;u(I.getImageData(A,k,w,$).data)},g=()=>{i(new Error("Image load failed"))};f.complete?l():(f.onload=l,f.onerror=g)}),t=[];for(let u=0;u<e.length;u+=4){const i=e[u],n=e[u+1],I=e[u+2];if(e[u+3]<255)continue;const g=ze(i,n,I);t.push(g)}const a=vt.quantize(t,128);return Pe.score(a)[0]}const It=async f=>{const e=q(f),t=await bt(e[0]);return qe(t)},ye=()=>ee("OK"),xe=()=>ee("Cancel"),yt=f=>{const e=Object.assign({},{confirmText:ye(),cancelText:xe(),onConfirm:j,onCancel:j,validator:j,textFieldOptions:{}},f),t=["headline","description","icon","closeOnEsc","closeOnOverlayClick","stackedActions","queue","onOpen","onOpened","onClose","onClosed","onOverlayClick"],a=new Fe;return Object.entries(e.textFieldOptions).forEach(([o,c])=>{a[o]=c}),new Promise((o,c)=>{let u=!1;const i=Ee({...Object.fromEntries(t.filter(n=>!Ce(e[n])).map(n=>[n,e[n]])),body:a,actions:[{text:e.cancelText,onClick:n=>e.onCancel.call(n,a.value,n)},{text:e.confirmText,onClick:n=>{const I=()=>{const g=e.onConfirm.call(n,a.value,n);return Z(g)?g.then(()=>{u=!0}):g!==!1&&(u=!0),g};if(a.setCustomValidity(""),!a.reportValidity())return!1;const l=e.validator.call(a,a.value);return Ne(l)&&!l?(a.setCustomValidity(" "),!1):Ve(l)?(a.setCustomValidity(l),!1):Z(l)?new Promise((g,E)=>{l.then(g).catch(y=>{a.setCustomValidity(y),E(y)})}):I()}}]});f.confirmText||Y(i,()=>{q(i).find('[slot="action"]').last().text(ye())}),f.cancelText||Y(i,()=>{q(i).find('[slot="action"]').first().text(xe())}),q(i).on("close",n=>{n.target===i&&(u?o(a.value):c(),ke(i))})})};let ae=class extends ce{render(){return ue('<path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>')}};ae.styles=le;ae=re([oe("mdui-icon-settings")],ae);let ne=class extends ce{render(){return ue('<path d="M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>')}};ne.styles=le;ne=re([oe("mdui-icon-security")],ne);let ie=class extends ce{render(){return ue('<path d="M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10a2.5 2.5 0 0 0 2.5-2.5c0-.61-.23-1.2-.64-1.67a.528.528 0 0 1-.13-.33c0-.28.22-.5.5-.5H16c3.31 0 6-2.69 6-6 0-4.96-4.49-9-10-9zm5.5 11c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm-3-4c-.83 0-1.5-.67-1.5-1.5S13.67 6 14.5 6s1.5.67 1.5 1.5S15.33 9 14.5 9zM5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S7.33 13 6.5 13 5 12.33 5 11.5zm6-4c0 .83-.67 1.5-1.5 1.5S8 8.33 8 7.5 8.67 6 9.5 6s1.5.67 1.5 1.5z"/>')}};ie.styles=le;ie=re([oe("mdui-icon-palette")],ie);const xt={class:"content"},Ct={value:"global","full-width":"",variant:"secondary"},kt={value:"global"},Et={value:"security"},wt={value:"game"},At={value:"appearance"},$t={slot:"panel",value:"global"},Rt=["label","value"],Ot=["label","value"],St=["label","value"],Bt={slot:"helper",class:"error-info"},Tt=["disabled"],Gt=["checked"],Mt={key:1},Lt=["disabled"],Pt={key:1},zt={key:2},qt={slot:"panel",value:"security"},Ft=["label","value"],Nt={slot:"helper",class:"error-info"},Vt=["label","value"],Dt={slot:"helper",class:"error-info"},jt={slot:"panel",value:"game"},Ut={slot:"panel",value:"appearance"},Ht=["label","value"],Wt=["value"],Kt={key:0,class:"appearance-card"},Qt=["label","value"],_t=["label","value"],Xt=["value"],Jt=["label","value"],Zt={class:"color-scheme"},Yt=["disabled"],es={key:1,class:"error-info"},ts={key:2},ss=["value"],as=["value"],ns=["disabled"],is=["disabled"],ls=["disabled"],rs={key:3,class:"error-info"},os=De({__name:"SettingView",setup(f){const e=et(),{t}=je();Ue();var a=He(),o=a.getUsername(),c=new Q.Object("UserInfo"),u=new Q.Object("Email"),i=new Q.Object("PrivateUserInfo");const n=de({nickname:"",email:a.get("email")||"",hasEmail:!!a.get("email"),emailChanged:!1,isPublicEmail:!1,isVerifiedEmail:a.get("emailVerified")||!1,verifyEmailClicked:!1,verifyEmailFailed:!1,emailErrorInfo:""});var I=de(me),l=F(_.value),g=F(_.value.name);te.get("userInfo").then(s=>{s&&(c=s,n.nickname=c.get("nickname"))}),te.get("email").then(s=>{s&&(u=s,n.isPublicEmail=s.getACL()?.getPublicReadAccess())}),te.get("privateUserInfo").then(s=>{s&&(i=s)});function E(){W(t("setting.message.failedAutoSave"),!0)}D(()=>n.nickname,st(s=>{s&&(c.set("nickname",s),c.save().catch(()=>{E()}))},1e3)),D(()=>n.email,s=>{n.emailErrorInfo="",n.hasEmail=!!s,n.emailChanged=s!==a.get("email"),s&&!fe(s)&&(n.emailErrorInfo=t("setting.message.incorrectEmailFormat"))});function y(){if(n.emailErrorInfo="",n.email&&!fe(n.email)){n.emailErrorInfo=t("setting.message.incorrectEmailFormat");return}a.setEmail(n.email),a.save().then(s=>(n.isVerifiedEmail=s.get("emailVerified"),u.set("email",n.email))).then(()=>{n.emailChanged=!1,W(t("setting.message.emailSaved"),!0)}).catch(s=>{if(s.code==203){n.emailErrorInfo=t("setting.message.emailUsed");return}n.emailErrorInfo=t("setting.message.failedSaveEmail")}),n.verifyEmailClicked=!1,n.verifyEmailFailed=!1}function A(s){n.isPublicEmail=s,u.getACL().setPublicReadAccess(s),u.save().then(()=>{W(t("setting.message.emailPublicChanged"),!0)}).catch(r=>{W(t("setting.message.failedChangeEmailPublic"),!0)})}function k(){Q.User.requestEmailVerify(n.email).then(()=>{n.verifyEmailClicked=!0}).catch(s=>{n.verifyEmailFailed=!0})}var w=F(""),$=F(""),d=F({password:"",passwordAgain:""}),C=F(!1);function R(){if(d.value={password:"",passwordAgain:""},C.value=!1,w.value)if(Ze(w.value))if(w.value!==$.value){d.value.passwordAgain=t("setting.message.differentPassword");return}else a.setPassword(w.value),a.save().then(()=>{W(t("setting.security.password.message.changed")),Ye(!1),e.push({name:"Login"})}).catch(()=>{d.value.password=t("setting.message.failedSave")});else{d.value.password=t("setting.message.incorrectPasswordFormat");return}else{d.value.password=t("setting.message.emptyPassword");return}}D(at,s=>{s&&I.splice(0,I.length,...me)});var L=We(()=>JSON.stringify(l.value)!==JSON.stringify(I.find(s=>s.name===g.value)));D(g,(s,r)=>{if(!s){g.value=r;return}var h=I.find(we=>we.name===s);h&&(l.value=h,_.value={...l.value})}),D(l,s=>{_.value=s}),D(()=>l.value.backgroundImage,(s,r)=>{s&&r||(l.value.backgroundImageOpacity=.3,l.value.sidebarOpacity=.7)});var G=F("");function p(){G.value="";var s=new Image;s.src=l.value.backgroundImage,s.crossOrigin="anonymous",s.onload=()=>{It(s).then(r=>{l.value.colorScheme=r}).catch(r=>{G.value=r.message})},s.onerror=r=>{G.value=t("setting.message.failedLoadBackgroundImage")}}var v=F("");function S(s){i.set("customAppearance",I.filter(r=>!r.isGeneral)),i.save().catch(()=>{s&&(v.value=s)})}function P(){v.value="";var s=I.find(h=>h.name===g.value);if(s){var r=I.find(h=>h.name===l.value.name);if(r&&r!==s){v.value="主题名已存在。";return}Object.assign(s,{...l.value})}else I.push({...l.value});i.get("activeAppearance")===g.value&&i.set("activeAppearance",l.value.name),S("保存时出现问题。请检查网络连接。")}function V(){v.value="",yt({headline:"另存为新的主题",description:"在此处键入主题名。",confirmText:"完成",cancelText:"取消",onConfirm:s=>{if(!s){v.value="主题名不能为空。";return}if(I.some(h=>h.name===s)){v.value="主题名已存在。";return}var r={...l.value,name:s,isGeneral:!1};I.push(r),g.value=s,S("")}})}function U(){v.value="",i.set("activeAppearance",g.value),i.save().then(()=>{tt(l.value)}).catch(()=>{v.value="应用时出现问题。请检查网络连接。"})}function H(){v.value="",lt({headline:"确认要删除主题吗？",description:"此操作不可撤销。",confirmText:"删除",cancelText:"取消",onConfirm:()=>{I=I.filter(s=>s.name!==g.value),g.value==i.get("activeAppearance")&&i.set("activeAppearance",I.find(s=>s.isGeneral)?.name||""),g.value=i.get("activeAppearance"),i.save().catch(()=>{v.value="删除失败。请检查网络连接。"})}})}return(s,r)=>(B(),T("div",xt,[m("h1",null,b(s.$t("setting.title")),1),m("mdui-tabs",Ct,[m("mdui-tab",kt,[N(b(s.$t("setting.global.title"))+" ",1),r[20]||(r[20]=m("mdui-icon-settings",{slot:"icon"},null,-1))]),m("mdui-tab",Et,[N(b(s.$t("setting.security.title"))+" ",1),r[21]||(r[21]=m("mdui-icon-security",{slot:"icon"},null,-1))]),m("mdui-tab",wt,[N(b(s.$t("setting.game.title"))+" ",1),r[22]||(r[22]=m("mdui-icon-videogame-asset",{slot:"icon"},null,-1))]),m("mdui-tab",At,[N(b(s.$t("setting.appearance.title"))+" ",1),r[23]||(r[23]=m("mdui-icon-palette",{slot:"icon"},null,-1))]),m("mdui-tab-panel",$t,[m("h2",null,b(s.$t("setting.global.title")),1),m("mdui-text-field",{label:s.$t("setting.global.username.title"),variant:"outlined",readonly:"",value:x(o)},null,8,Rt),m("mdui-text-field",{label:s.$t("setting.global.nickname.title"),value:n.nickname,onInput:r[0]||(r[0]=h=>n.nickname=h.target.value),required:""},null,40,Ot),m("h3",null,b(s.$t("setting.global.email.title")),1),m("mdui-text-field",{type:"email",label:s.$t("setting.global.email.title"),value:n.email,onInput:r[1]||(r[1]=h=>n.email=h.target.value)},[m("span",Bt,b(n.emailErrorInfo),1)],40,St),m("mdui-button",{disabled:!n.emailChanged,onClick:r[2]||(r[2]=h=>y())},b(s.$t("setting.global.email.operation.save")),9,Tt),n.hasEmail?(B(),T("mdui-checkbox",{key:0,checked:n.isPublicEmail,onInput:r[3]||(r[3]=h=>A(!h.target.checked))},b(s.$t("setting.global.email.operation.madePublic")),41,Gt)):z("",!0),n.hasEmail?(B(),T("div",Mt,[N(b(s.$t("setting.global.email.status.title",{status:n.isVerifiedEmail?s.$t("setting.global.email.status.verified"):s.$t("setting.global.email.status.unverified")}))+" ",1),n.isVerifiedEmail?z("",!0):(B(),T("mdui-button",{key:0,onClick:r[4]||(r[4]=h=>k()),disabled:!n.emailChanged&&n.hasEmail&&n.verifyEmailClicked},b(s.$t("setting.global.email.operation.verify")),9,Lt)),n.verifyEmailClicked?(B(),T("span",Pt,b(s.$t("setting.global.email.status.message.clicked")),1)):z("",!0),n.verifyEmailFailed?(B(),T("span",zt,b(s.$t("setting.global.email.status.message.failed")),1)):z("",!0)])):z("",!0)]),m("mdui-tab-panel",qt,[m("h2",null,b(s.$t("setting.security.title")),1),m("h3",null,b(s.$t("setting.security.password.change.title")),1),m("mdui-text-field",{type:"password","toggle-password":"",label:s.$t("setting.security.password.new.title"),value:x(w),onInput:r[5]||(r[5]=h=>se(w)?w.value=h.target.value:w=h.target.value)},[m("span",Nt,b(x(d).password),1)],40,Ft),m("mdui-text-field",{type:"password","toggle-password":"",label:s.$t("setting.security.password.ensureNew.title"),value:x($),onInput:r[6]||(r[6]=h=>se($)?$.value=h.target.value:$=h.target.value)},[m("span",Dt,b(x(d).passwordAgain),1)],40,Vt),m("mdui-button",{onClick:r[7]||(r[7]=h=>R())},b(s.$t("setting.security.password.operation.change")),1)]),m("mdui-tab-panel",jt,[m("h2",null,b(s.$t("setting.game.title")),1),m("mdui-checkbox",null,b(s.$t("setting.game.madeHistoryPublic.title")),1),r[24]||(r[24]=m("br",null,null,-1)),m("mdui-checkbox",null,b(s.$t("setting.game.autoDisableUnavailableSkill.title")),1),m("h3",null,b(s.$t("setting.game.customSkill.title")),1),m("p",null,b(s.$t("setting.game.customSkill.disc")),1)]),m("mdui-tab-panel",Ut,[m("h2",null,b(s.$t("setting.appearance.title")),1),m("h3",null,b(s.$t("setting.appearance.theme.title")),1),m("mdui-select",{label:s.$t("setting.appearance.theme.select.title"),value:x(g),onChange:r[8]||(r[8]=h=>se(g)?g.value=h.target.value:g=h.target.value)},[(B(!0),T(ge,null,he(x(I),h=>(B(),T("mdui-menu-item",{value:h.name},b(h.name),9,Wt))),256)),r[25]||(r[25]=m("mdui-button-icon",{slot:"end-icon"},[m("mdui-icon-keyboard-arrow-down")],-1))],40,Ht),x(g)?(B(),T("mdui-card",Kt,[Ke(pe,{color:"grey",tag:x(l).isGeneral?s.$t("setting.appearance.theme.type.general"):s.$t("setting.appearance.theme.type.custom")},null,8,["tag"]),x(g)==x(i).get("activeAppearance")?(B(),Qe(pe,{key:0,color:"green",tag:s.$t("setting.appearance.theme.applied.title")},null,8,["tag"])):z("",!0),m("mdui-text-field",{label:s.$t("setting.appearance.theme.name.title"),value:x(l).name,onInput:r[9]||(r[9]=h=>x(l).name=h.target.value)},null,40,Qt),m("mdui-select",{label:s.$t("setting.appearance.theme.lightDark.title"),value:x(l).theme,onChange:r[10]||(r[10]=h=>x(l).theme=h.target.value)},[(B(),T(ge,null,he(["auto","light","dark"],h=>m("mdui-menu-item",{value:h},b(s.$t("setting.appearance.theme.lightDark."+h)),9,Xt)),64)),r[26]||(r[26]=m("mdui-button-icon",{slot:"end-icon"},[m("mdui-icon-keyboard-arrow-down")],-1))],40,_t),m("mdui-text-field",{label:s.$t("setting.appearance.theme.backgroundImage.title"),value:x(l).backgroundImage,onInput:r[11]||(r[11]=h=>x(l).backgroundImage=h.target.value)},null,40,Jt),m("div",Zt,[N(b(s.$t("setting.appearance.theme.colorScheme.title")),1),_e(m("input",{type:"color","onUpdate:modelValue":r[12]||(r[12]=h=>x(l).colorScheme=h),style:{"margin-left":"4px"}},null,512),[[Xe,x(l).colorScheme]]),m("mdui-button",{onClick:r[13]||(r[13]=h=>p()),disabled:!x(l).backgroundImage},b(s.$t("setting.appearance.theme.colorScheme.getColorFromImage")),9,Yt)]),x(G)?(B(),T("div",es,b(s.$t("setting.appearance.theme.colorScheme.error",{colorErrorInfo:x(G)})),1)):z("",!0),x(l).backgroundImage?(B(),T("div",ts,[N(b(s.$t("setting.appearance.theme.opacity.backgroundImage"))+" ",1),m("mdui-slider",{tickmarks:"",max:"10",step:"1",value:x(l).backgroundImageOpacity*10,onInput:r[14]||(r[14]=h=>x(l).backgroundImageOpacity=h.target.value/10)},null,40,ss),N(" "+b(s.$t("setting.appearance.theme.opacity.sidebar"))+" ",1),m("mdui-slider",{tickmarks:"",max:"10",step:"1",value:x(l).sidebarOpacity*10,onInput:r[15]||(r[15]=h=>x(l).sidebarOpacity=h.target.value/10)},null,40,as)])):z("",!0),m("mdui-button",{onClick:r[16]||(r[16]=h=>P()),disabled:!x(L)||x(l).isGeneral},b(s.$t("setting.appearance.theme.operation.save")),9,ns),m("mdui-button",{onClick:r[17]||(r[17]=h=>V())},b(s.$t("setting.appearance.theme.operation.saveAs")),1),m("mdui-button",{onClick:r[18]||(r[18]=h=>U()),disabled:x(g)==x(i).get("activeAppearance")},b(s.$t("setting.appearance.theme.operation.apply")),9,is),m("mdui-button",{onClick:r[19]||(r[19]=h=>H()),disabled:x(l).isGeneral,style:Je({backgroundColor:x(l).isGeneral?"":"rgb(var(--mdui-color-error))"})},b(s.$t("setting.appearance.theme.operation.delete")),13,ls),x(v)?(B(),T("div",rs,b(s.$t("setting.appearance.theme.message.failedSave",{savingErrorInfo:x(v)})),1)):z("",!0)])):z("",!0)])])]))}}),hs=nt(os,[["__scopeId","data-v-9ea7b51f"]]);export{hs as default};
